# í˜„ì¬ í´ëŸ¬ìŠ¤í„° í™˜ê²½ì— ìµœì í™”ëœ Jenkins ì„¤ì •

controller:
  image:
    repository: "jenkins/jenkins"
    tag: "2.504.3-jdk21"
    pullPolicy: "IfNotPresent"

  admin:
    username: "admin"
    password: "test123"

  # í”ŒëŸ¬ê·¸ì¸ - ëª¨ë‹ˆí„°ë§ í™˜ê²½ì— ë§ê²Œ ìµœì†Œí™”
  installPlugins:
    - kubernetes:4253.v7700d91739e5
    - workflow-aggregator:596.v8c21c963d92d
    - git:5.2.1
    - configuration-as-code:1963.v24e046127a_3f
    - prometheus:2.0.6  # ê¸°ì¡´ Prometheusì™€ ì—°ë™

  # Init Container - ì—¬ìœ ìˆê²Œ ì„¤ì •
  initContainerResources:
    requests:
      cpu: "800m"         # ì¶©ë¶„í•œ CPU
      memory: "1.5Gi"     # 1.5GB
    limits:
      cpu: "1500m"
      memory: "2.5Gi"     # 2.5GB

  initContainerEnv:
    - name: "JAVA_OPTS"
      value: "-Xmx2048m -Xms512m"  # 2GB JVM í™
    - name: "JENKINS_UC_DOWNLOAD_TIMEOUT"
      value: "900"

  # ë©”ì¸ Jenkins ì»¨í…Œì´ë„ˆ - ì ì ˆí•œ ë¦¬ì†ŒìŠ¤
  resources:
    requests:
      cpu: "800m"         # 0.8 CPU
      memory: "1.5Gi"     # 1.5GB
    limits:
      cpu: "1500m"        # 1.5 CPU
      memory: "2.5Gi"     # 2.5GB (EC2 ëŒ€ë¹„ ì¶©ë¶„)

  # JVM ì„¤ì • - ë©”ëª¨ë¦¬ íš¨ìœ¨ì 
  javaOpts: "-Xmx2048m -Xms512m -Djenkins.install.runSetupWizard=false -XX:+UseContainerSupport -XX:MaxRAMPercentage=80"
  
  jenkinsOpts: "--httpPort=8080"
  serviceType: "ClusterIP"
  servicePort: 8080

  # Health Check - ì¶©ë¶„í•œ ì‹œê°„
  healthProbeLivenessInitialDelay: 180    # 3ë¶„
  healthProbeReadinessInitialDelay: 120   # 2ë¶„
  healthProbeLivenessTimeout: 10
  healthProbeReadinessTimeout: 10

  # ë…¸ë“œ ë°°ì¹˜ ì „ëµ (Prometheus í”¼í•˜ê¸°)
  nodeSelector: {}
  
  # Prometheusì™€ ê°™ì€ ë…¸ë“œ í”¼í•˜ê¸°
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
            - key: app.kubernetes.io/name
              operator: In
              values: ["prometheus"]
          topologyKey: kubernetes.io/hostname

  runAsUser: 1000
  fsGroup: 1000

# Agent - í™œì„±í™” (ë¦¬ì†ŒìŠ¤ ì—¬ìœ  ìˆìŒ)
agent:
  enabled: true
  image:
    repository: "jenkins/inbound-agent"
    tag: "4.13.3-1-jdk17"
  
  resources:
    requests:
      cpu: "300m"
      memory: "512Mi"
    limits:
      cpu: "800m"
      memory: "1Gi"

# ì˜êµ¬ ì €ì¥ì†Œ - ë„‰ë„‰í•˜ê²Œ
persistence:
  enabled: true
  storageClass: "gp2"    # AWS EBS GP2 ì‚¬ìš©
  accessMode: "ReadWriteOnce"
  size: "30Gi"           # 30GB (ì„±ëŠ¥ê³¼ ê³µê°„ í™•ë³´)

# RBAC
rbac:
  create: true
  readSecrets: false

serviceAccount:
  create: true
  name: ""

# ëª¨ë‹ˆí„°ë§ ì—°ë™ (ê¸°ì¡´ Prometheus í™œìš©)
prometheus:
  enabled: true
  serviceMonitorAdditionalLabels:
    release: kube-prometheus-stack  # ê¸°ì¡´ Prometheusì™€ ì—°ë™
  
# ë°±ì—… ì„¤ì •
backup:
  enabled: false

# Jenkins Configuration as Code
JCasC:
  defaultConfig: true
  configScripts:
    welcome-message: |
      jenkins:
        systemMessage: "Welcome to Jenkins on Kubernetes! ğŸš€"
    prometheus-config: |
      unclassified:
        prometheusConfiguration:
          path: "prometheus"
          useAuthenticatedEndpoint: false